# AWS CodePipeline Hands-on
Pre-requisite: Git installed and configured on your local machine.<br>
1. Create HttpGitCredentials using IAM for code pipeline.<br>
   - IAM-->Users-->Click on the existing user name -->Permissions -->Add Permission -->AWS CodeBuildAdminAccess<br>
   - SecurityCredentials --> HttpGitCredentialsFor AWS CodeCommit --> Generate Credentials --> Download Credentials --> Save it on local machine <br>

2. Create repository on CodeCommit.<br>
   This repository serves as source code for AWS CodePipeline <br>
   - CodeCommit --> Repository --> Create Repository --> Name: SampleWebApp --> Create <br>
   - For cloning this repository to local machine click --> Clone URL --> Clone Https<br>

3. Create a sample folder on desktop of local machine.<br>
   - create new folder sample<br>
   - cd sample <br>
   - git clone http:// ...<br>
   - Provide username and pwd for Git Credential Manager <br>
   - cd SampleWebApp<br>
   - here add web application files<br>
   - git status<br>
   - Now you can see the contents of Webapplication<br>
   - git add -A<br>
   - git commit -m "uploading"<br>
   - Push code to the code repository of the codecommit.<br>
   - git push <br>

4. Create service role for Application and Deployment Group<br>
   - IAM --> Roles --> Create Role --> Locate CodeDeploy Service --> Click on that --><br>
   - Select your use case: CodeDeploy --> Click Next Permissions --> AWS CodeDeploy Role --> <br>
   - Next Tags --> Next Review --> RoleName: AWSCodeDeployRole --> Create Role<br>

5. Goto CodeCommit Repository.<br>
   - You can view the source code here<br>

6. Create an EC2 Instance <br>
    - Name: CodePipelineInstance<br>
    - Choose AMI Linux<br>
    - Instance Type: t2.micro
    - Select key pair
    - Advanced Details --> user data -->
   ```sh
      #!/bin/bash
      sudo yum -y update
      sudo yum install -y ruby
      sudo yum install -y aws-cli
      sudo cd /home/ec2-user
      sudo wget https://aws-codedeploy-us-east-2.s3.us-east-2.amazonaws.com/latest/install
      sudo chmod +x ./install
      sudo ./install auto
   ```
     - launch the EC2 instance<br>

7. Goto CodeDeploy to create deploy application and deployment group<br>
  - CodeDeploy --> Applications --> Create application --> ApplicationName: SampleApp <br>
  - --> ComputePlatform: EC2/On-Premises --Create Application<br>

8. Create Deployment Group<br>
  - click Deployment Group<br>
  - Click on CreateDeploymentGroup --> GroupName: SampleGroup <br>
  - Enter a service role: select a role: code-deploy-myWebApp --> Deployment type: in-place <br>
  - Environment configuration: Amazon EC2 instances --> Key: Name, Value: CodePipelineInstance<br>
  - Uncheck: Enable Load balancing --> Create deployment group <br>

9. Create code pipeline<br>
  - Pipelines --> Create pipeline --> pipeline name: SamplePipeline --><br>
  - Service Role: New Service Role<br>
  - RoleName: Autogenerated<br>
  - Next --> Source provider: select AWS CodeCommit --> Repository Name: SampleWebApp --><br>
  - Branch: master --> Next --> Skip Build Stage --> <br>
  - Add Deploy Stage<br>
  - Deploy Provider: AWS CodeDeploy --> Region: choose --> <br>
  - Application Name: SampleApp --> Deployment Group: SampleGroup --> Review --><br>
  - Create Pipeline --> source stage --> deploy stage --> should be successful<br>

10. Verify deployment on EC2 instance<br>
  - Go to EC2 instance --> Public IPv Address --> Copy --> Paste it in a browser <br>
  - See your application successfully deployed.


# Troubleshooting - while git clone
```sh
Fix aws codecommit unable to access repository (The requested URL returned error: 403) in windows
this was tested using windows10 pro

when cloning a git this error was produced
fatal: unable to access 'https://git-codecommit.us-east-1.amazonaws.com/v1/repos/RepositoryName': The requested URL returned error: 403

to fix add the following git configuration
git config --global credential.helper "!aws codecommit credential-helper $@"
git config --global credential.UseHttpPath true

check if git has system credential.helper by typing 
git config --system -l

if it has remove it by typing
git config --system --unset credential.helper
```

# Troubleshooting - CodeDeploy agent was not able to receive the lifecycle event. Check the CodeDeploy agent logs on your host and make sure the agent is running and can connect to the CodeDeploy server. View more.
```sh
AWS error messages may not adequately interpret the errors encountered.
One likely case is iam permission issues.
Make sure CodeDeploy has CodeDeployRole and your EC2 instance(s) have AmazonEC2RoleforAWSCodeDeploy.
```

```sh
To check if an Amazon EC2 instance has AmazonEC2RoleforAWSCodeDeploy,
you can use the AWS CLI to get the public DNS of the instance.
You can then use the describe-instances command to call for the public DNS.
```

```sh
How to access /var/www/html/index.html file path through
```

# To get a password for an Amazon EC2 instance, you can use the Amazon EC2 console or the AWS CLI: 
```sh
Amazon EC2 console 
Open the Amazon EC2 console and select Instances 
Select the instance and expand the Actions dropdown list 
Select Get Windows Password 
Select Browse and choose your key pair file 
Select Decrypt Password
```

# How to access s3://aws-codedeploy-us-east-1/latest/install


